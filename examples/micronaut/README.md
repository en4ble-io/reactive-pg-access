# Micronaut + graalvm + kotlin + reactive-pg-access + JOOQ + liquibase example

This example project is based on the code generated by running this command:

mn create-app example.micronaut.complete --features=graal-native-image,kotlin 

And extended with

* reactive-pg-access
* JOOQ code generation
* liquibase
* code to retrieve the random conference from database :) 

## Features

* Generates a database access layer using JOOQ and reactive-pg-client
* Tables are generated from liquibase
* DTOs contain Openapi and Validation annotations generated from the database definition.
* Openapi yaml generated by Micronaut
* Shows how to use reactive-pg-client
    * create, read, update, updateReturning, delete
    * database views
    * generate validation annotations from database comments
    * generate ignore annotations from using the {{internal}} comment

## Database setup

JOOQ, liquibase and the microservice expect the followig database setup:

* database: postgres
* user: postgres
* password: postgres
* schema: example

You can change the runtime configuration via the application.yml file.

## Building + Running the example microservice

1. Clone and build reactive-pg-access
    * ``git clone git@bitbucket.org:en4bleio/reactive-pg-access.git``
    * ``./gradlew clean install``
2. Create the schema
    * ``psql -d postgres -c "create schema example"``
3. Start the microservice
    * ``./gradlew run``
  
## Invoking the endpoints

* Get the generated openapi definition
    * ``curl http://localhost:8080/openapi/example-0.1.yml``
* Get a random conference 
    * ``curl http://localhost:8080/conferences/random``
* Create a conference
    * ``curl --request POST \
          --url http://localhost:8080/conferences \
          --header 'content-type: application/json' \
          --data '{
        	"name":"Test x",
        	"about":"sdf hjkhj khkljhkljhlj hlhljk",
        	"startDate": "2019-05-12",
          "endDate": "2019-05-14"
        }'``
* Read a conference
    * ``curl --request GET \
          --url http://localhost:8080/conferences/6bf416c1-9d12-48c6-b30f-4e797b7ac934``
* Search
    * ``curl --request POST \
          --url http://localhost:8080/conferences/search \
          --header 'content-type: application/json' \
          --data '{
        	"name":"Test"
        }'``
* Update
    * ``curl --request PUT \
          --url http://localhost:8080/conferences/6bf416c1-9d12-48c6-b30f-4e797b7ac934 \
          --header 'content-type: application/json' \
          --data '{
        	"name":"Test xy",
        	"about":"sdf haaaaaaaahlj hlhljk"
        }'``
* Delete
    * ``curl --request DELETE \
          --url http://localhost:8080/conferences/6bf416c1-9d12-48c6-b30f-4e797b7ac934``
## TODO

* use micronaut-liquibase (currently using custom code since I couldn't get the plugin to generate the tables)
* test graalvm


